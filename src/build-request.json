{
  "kind": "build_request",
  "title": "Restore Internet Identity login button and authentication flow",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-88",
      "text": "Add Internet Identity login button back to LoginPage UI alongside the existing email/password login form, ensuring both authentication methods are visible and accessible to users",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "There's no button for internet identity",
          "After you did the last request"
        ]
      },
      "acceptanceCriteria": [
        "LoginPage displays an Internet Identity login button in addition to the existing email/password form",
        "The II button is visually distinct and clearly labeled (e.g., 'Login with Internet Identity')",
        "Both authentication options are presented in a clear, user-friendly layout"
      ]
    },
    {
      "id": "REQ-89",
      "text": "Wire the Internet Identity login button to trigger the useInternetIdentity authentication flow, opening the Internet Identity authentication window when clicked",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "I'll add it back alongside the existing email/password form and ensure the full authentication flow works properly"
        ]
      },
      "acceptanceCriteria": [
        "Clicking the II button invokes the login method from useInternetIdentity hook",
        "The Internet Identity authentication window opens correctly",
        "The button shows appropriate loading/disabled state during authentication"
      ]
    },
    {
      "id": "REQ-90",
      "text": "Ensure successful Internet Identity login immediately updates authentication state in useAuth context, setting isAuthenticated to true and populating user data synchronously across all consuming components",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "ensure the full authentication flow works properly",
          "successful login updates the Header to show profile dropdown and admin link"
        ]
      },
      "acceptanceCriteria": [
        "After successful II authentication, useAuth context updates isAuthenticated flag immediately",
        "User state is populated with identity information from Internet Identity",
        "All components consuming useAuth hook receive updated authentication state"
      ]
    },
    {
      "id": "REQ-91",
      "text": "Trigger actor initialization immediately after successful Internet Identity login completes, ensuring the backend actor is created with the authenticated identity before any profile queries execute",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "ensure the full authentication flow works properly"
        ]
      },
      "acceptanceCriteria": [
        "Actor initialization begins immediately after II login succeeds",
        "Actor is fully created and ready before profile queries are enabled",
        "No undefined actor errors occur during post-login UI rendering"
      ]
    },
    {
      "id": "REQ-92",
      "text": "Invalidate and refetch user profile queries immediately after successful Internet Identity login to load admin/premium role information, triggering Header component to re-render with profile dropdown and admin link",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "successful login updates the Header to show your profile dropdown and admin link"
        ]
      },
      "acceptanceCriteria": [
        "User profile query is invalidated and refetched after II login completes",
        "Profile data including role information (admin/premium) is available",
        "Header component re-renders showing authenticated UI (profile dropdown, admin link) instead of login button"
      ]
    },
    {
      "id": "REQ-93",
      "text": "Implement proper navigation after successful Internet Identity login, redirecting users to the home page without triggering navigation during render or causing redirect loops",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "navigation works correctly after II login completes"
        ]
      },
      "acceptanceCriteria": [
        "After successful II login, user is redirected to home page",
        "Navigation occurs after authentication state updates complete",
        "No navigation-during-render warnings or redirect loops occur",
        "User can immediately interact with authenticated features after redirect"
      ]
    }
  ],
  "constraints": [
    "Do not modify the read-only useInternetIdentity.ts hook file",
    "Preserve all existing email/password authentication functionality",
    "Maintain the current LoginPage layout and styling while adding the II button",
    "Ensure Internet Identity authentication does not interfere with email/password login flows"
  ],
  "nonGoals": [
    "Modifying the Internet Identity service or authentication protocol itself",
    "Adding profile setup or email collection during II login flow",
    "Changing the authentication state management architecture beyond fixing propagation issues",
    "Adding new authentication methods beyond restoring Internet Identity"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}
{
  "kind": "build_request",
  "title": "Fix broken login (email/password + Internet Identity)",
  "projectName": "FAITH X-Stream",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-12",
      "text": "Restore working email/password authentication so users can register and log in successfully from the Login page, without requiring Internet Identity.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Please fix the platform, Im not able to log in at all"
        ]
      },
      "acceptanceCriteria": [
        "A new user can successfully register via the Sign Up tab on /login and is redirected to / after success.",
        "An existing user can successfully log in via the Login tab on /login and is redirected to / after success.",
        "Registration and login do not fail due to backend access control initialization or authorization traps.",
        "Login failures show a clear, user-readable error message (not a generic failure) on the Login page toast."
      ]
    },
    {
      "id": "REQ-13",
      "text": "Fix backend authentication and access control so that calling register/login from an unauthenticated (anonymous) frontend session does not trap and can correctly establish a user session for subsequent user-only actions (e.g., getCallerUserProfile).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Please fix the platform, Im not able to log in at all"
        ]
      },
      "acceptanceCriteria": [
        "Backend register/login succeed from an anonymous caller context without trapping due to uninitialized access control state.",
        "After successful email/password login, getCallerUserProfile returns the stored profile for that caller session (and does not trap with Unauthorized).",
        "Error cases (invalid email/password, email already registered) return consistent errors that the frontend can display."
      ]
    },
    {
      "id": "REQ-14",
      "text": "Fix the frontend authentication state machine so that login status, session restoration, and actor initialization do not prevent logging in (email/password) and do not leave the UI stuck in an initializing/authenticating state.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Please fix the platform, Im not able to log in at all"
        ]
      },
      "acceptanceCriteria": [
        "The Login button is not stuck on \"Loading...\" indefinitely on first app load.",
        "Clicking Login (email/password) while the actor is still initializing either waits safely or shows a clear message, and then proceeds when ready.",
        "If a stored emailAuth session exists, the app restores it reliably and sets authenticated UI state (Header shows profile menu, not Login button).",
        "If session restoration fails, the stored session is cleared and the app returns to an idle unauthenticated state without loops."
      ]
    },
    {
      "id": "REQ-15",
      "text": "Fix /login navigation/redirect behavior so it does not trigger navigation during render and does not cause redirect loops or blank screens when authentication state changes.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Please fix the platform, Im not able to log in at all"
        ]
      },
      "acceptanceCriteria": [
        "When already authenticated, visiting /login redirects to / without console errors/warnings about state updates or navigation during render.",
        "When unauthenticated, /login remains accessible and does not unexpectedly redirect away.",
        "After logout, the user can navigate to /login and log in again successfully."
      ]
    },
    {
      "id": "REQ-16",
      "text": "Ensure Internet Identity admin login still works end-to-end (button on Login page), including correct actor creation and access control initialization after II login.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Please fix the platform, Im not able to log in at all"
        ]
      },
      "acceptanceCriteria": [
        "Clicking \"Login with Internet Identity\" completes II login successfully when configured, and authenticated state becomes true.",
        "After II login, admin-only checks (e.g., isCallerAdmin) work and admin navigation items can appear when appropriate.",
        "Logging out clears the II session and returns the app to unauthenticated state."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo; only add backend/migration.mo if persisted state changes require it.",
    "Do not edit immutable frontend paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui."
  ],
  "nonGoals": [
    "Adding third-party authentication providers beyond Internet Identity.",
    "Implementing external databases or moving credential storage off-canister.",
    "Redesigning the overall UI beyond what is necessary to fix login reliability and messaging."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}